% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fun2tax_sankey.R
\name{fun2tax_sankey}
\alias{fun2tax_sankey}
\title{Sankey diagram: functions (KO/EC/MetaCyc) → taxa/features}
\usage{
fun2tax_sankey(
  pathway_sdaa_result,
  pathway = c("KO", "EC", "MetaCyc"),
  group_functions = TRUE,
  taxa_list = NULL,
  node_color = c(Up = "#ffa551", Down = "#70afdf"),
  node_neutral = "#999999",
  label_left_sources = TRUE,
  margin = list(top = 10, right = 200, bottom = 10, left = 180),
  height = 1200,
  width = 1000
)
}
\arguments{
\item{pathway_sdaa_result}{Named list. Names are function IDs (KO/EC/MetaCyc).
Each element is a data frame with columns including:
\itemize{
  \item \code{feature}: target/taxon (e.g., genus) label,
  \item \code{logFC}: log fold-change,
  \item a q/p-adjust column (any of: \code{p_adjust}, \code{padj},
        \code{qval}, \code{q_value}, \code{qvalue}, \code{p.adj}, \code{FDR}, \code{p_adj}).
}}

\item{pathway}{Character. Functional namespace of the names in
\code{pathway_sdaa_result}; one of \code{"KO"}, \code{"EC"}, \code{"MetaCyc"}.}

\item{group_functions}{Logical. If \code{TRUE}, map function IDs to higher
groups before linking to taxa (KO → \code{PathwayL1}; EC/MetaCyc → \code{description}).
Requires reference files in \pkg{MicroFun}'s \code{inst/extdata}.}

\item{taxa_list}{Optional character vector. If provided, keep only edges whose
\emph{source} (group label or function ID) matches one of these entries.}

\item{node_color}{Named character vector of length 2 with colors for link
groups: names must be \code{c("Up","Down")}. Default: orange for Up
(\code{"#ffa551"}), blue for Down (\code{"#70afdf"}).}

\item{node_neutral}{Character. Color for nodes (neutral "All" category).
Default \code{"#999999"}.}

\item{label_left_sources}{Logical. If \code{TRUE}, left-side node labels are
right-aligned and wrapped via JavaScript for readability. Default \code{TRUE}.}

\item{margin}{Named list with pixel margins \code{top}, \code{right},
\code{bottom}, \code{left}. Passed to \code{networkD3::sankeyNetwork()}.}

\item{height, width}{Numeric. Output size in pixels for the widget canvas.}
}
\description{
The input \code{pathway_sdaa_result} must be a **named list** where names are
function IDs (KO/EC/MetaCyc), and each element is a data frame containing at
least \code{feature} (target/taxon), \code{logFC}, and one multiple-testing
column (e.g., \code{p_adjust}, \code{padj}, \code{qval}, \code{FDR}). The
function:
\enumerate{
  \item normalizes function IDs (e.g., strips \code{"ko:"}, \code{"ec:"}),
  \item (optionally) maps IDs to higher-level groups using reference tables
        shipped in \pkg{MicroFun} (\code{inst/extdata/*_reference.RData}),
  \item assembles edges \emph{source → target} (group or function → taxon),
  \item scales link width by \eqn{\exp(\mathrm{logFC}) \times 10},
  \item colors links by direction (Up/Down), and
  \item returns an interactive \pkg{networkD3} sankey widget.
}
}
\details{
Build an interactive Sankey diagram linking functional features (KO, EC, or
MetaCyc IDs) — optionally grouped to higher-level categories — to taxa or
features reported in differential analysis results (e.g., from
\code{pathway_sdaa()}).
}
\examples{
\dontrun{
# Minimal toy example
sdaa_list <- list(
  K00001 = data.frame(feature = c("GenusA","GenusB"),
                      logFC = c( 1.1, -0.4),
                      p_adjust = c(0.02, 0.3)),
  K00002 = data.frame(feature = c("GenusB","GenusC"),
                      logFC = c(-1.6,  0.5),
                      p_adjust = c(0.01, 0.7))
)

# Function → taxon (no grouping)
p1 <- fun2tax_sankey(sdaa_list, pathway = "KO", group_functions = FALSE)
p1

# Group functions to higher-level categories (requires reference files)
p2 <- fun2tax_sankey(sdaa_list, pathway = "KO", group_functions = TRUE)
p2
}


}

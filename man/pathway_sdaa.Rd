% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pathway_sdaa.R
\name{pathway_sdaa}
\alias{pathway_sdaa}
\title{Stratified pathway-level DAA workflow for PICRUSt2 outputs}
\usage{
pathway_sdaa(
  stratified_path,
  physeq,
  taxon_level = "Genus",
  group,
  daa_method = "Maaslin2",
  p.adjust.method = "none",
  threshold = 0.05,
  direction = "taxa",
  pathway = "KO",
  confounders = NULL,
  reference = NULL,
  min_samples = 5,
  verbose = TRUE
)
}
\arguments{
\item{stratified_path}{Character scalar. Path to the stratified PICRUSt2 file
(tab-delimited) containing columns \code{sample}, \code{taxon},
\code{function}, \code{norm_taxon_function_contrib}.}

\item{physeq}{A \code{phyloseq} object with both \code{tax_table} (ASV rows)
and \code{sample_data}.}

\item{taxon_level}{Character scalar. Taxonomic rank used to aggregate ASVs
when \code{direction = "taxa"} (e.g., \code{"Genus"}). Must exist in
\code{phyloseq::tax_table(physeq)}.}

\item{group}{Character scalar. Column name in \code{sample_data(physeq)} for
the primary grouping variable. Coerced to factor; optionally releveled via
\code{reference}.}

\item{daa_method}{Character scalar. DAA backend passed to \code{pathway_daa()}
(e.g., \code{"Maaslin2"}, \code{"edgeR"}, \code{"DESeq2"}, \code{"limma voom"},
\code{"metagenomeSeq"}, \code{"Lefser"}).}

\item{p.adjust.method}{Character scalar. Multiple-testing adjustment method
forwarded to \code{pathway_daa()} (e.g., \code{"none"}, \code{"BH"}).}

\item{threshold}{Numeric. Significance cutoff used during result annotation
(typically FDR/q-value threshold). Default: \code{0.05}.}

\item{direction}{Character. One of \code{"taxa"} or \code{"function"}.
If \code{"taxa"}, ASV contributions are aggregated to \code{taxon_level}
and analyzed per-taxon table. If \code{"function"}, tables are built per
function (KO/EC/MetaCyc) across taxa.}

\item{pathway}{Character. Functional namespace of \code{function} IDs:
\code{"KO"}, \code{"EC"}, or \code{"MetaCyc"}. Controls annotation and
KOâ†’KEGG pathway summarization.}

\item{confounders}{Optional. Confounding covariates to adjust for in DAA
backends that support them. May be:
\itemize{
  \item a character vector of column names found in \code{sample_data(physeq)},
  \item a numeric/character vector (single confounder),
  \item or a \code{data.frame} of covariates (one column per variable).
}
\emph{Note:} This argument is prepared here; actual use depends on your
\code{pathway_daa()} implementation (ensure you forward it).}

\item{reference}{Optional character. Reference level for \code{group}; if
present, \code{group} is releveled accordingly.}

\item{min_samples}{Integer. Require strictly more than \code{min_samples}
samples (after metadata filtering) in a per-table subset to run DAA.
Default: \code{5}.}

\item{verbose}{Logical. If \code{TRUE}, print progress messages. Default \code{TRUE}.}
}
\description{
Given a PICRUSt2 stratified table (columns \code{sample}, \code{taxon},
\code{function}, \code{norm_taxon_function_contrib}) and a \code{phyloseq}
object, the function:
\enumerate{
  \item validates overlap of samples and taxa,
  \item aggregates ASV-level contributions to a chosen taxonomic rank
        (\code{taxon_level}) \emph{or} groups by each \code{function},
  \item constructs wide matrices (rows = function IDs; cols = samples),
  \item filters tables to ensure at least two groups and sufficient samples,
  \item runs \code{pathway_daa()} on each table,
  \item annotates significant results using \code{MicroFun::pathway_annotation()}
        or \code{result_annotation()} depending on \code{direction/pathway}.
}
}
\details{
Build per-\code{taxon} or per-\code{function} abundance tables from a
stratified PICRUSt2 file and run differential abundance analysis (DAA),
with optional annotation to KEGG/EC/MetaCyc names. Supports adjusting
the modeling design with confounders via backends that accept them
(e.g., MaAsLin2).
}
\examples{
\dontrun{
stratified_path <- "pred_metagenome_contrib.tsv"
# Minimal inputs
out <- pathway_sdaa(
  stratified_path = stratified_path,
  physeq          = physeq_obj,
  taxon_level     = "Genus",
  group           = "Group",
  daa_method      = "Maaslin2",
  p.adjust.method = "BH",
  threshold       = 0.05,
  direction       = "taxa",
  pathway         = "KO",
  confounders     = c("Age","Sex"),
  reference       = "Control",
  min_samples     = 5
)

# Function-centric EC analysis:
out_fun <- pathway_sdaa(
  stratified_path = stratified_path,
  physeq          = physeq_obj,
  taxon_level     = "Genus",
  group           = "Group",
  daa_method      = "edgeR",
  direction       = "function",
  pathway         = "EC"
)
}

}
\seealso{
\code{\link{pathway_daa}},
  \code{MicroFun::pathway_annotation},
  \code{result_annotation},
  \pkg{phyloseq}
}

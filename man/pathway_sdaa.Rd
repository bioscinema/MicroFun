% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pathway_sdaa.R
\name{pathway_sdaa}
\alias{pathway_sdaa}
\title{Stratified pathway-level DAA from PICRUSt2 outputs}
\usage{
pathway_sdaa(
  stratified_path,
  physeq,
  taxon_level = "Genus",
  group,
  daa_method = "Maaslin2",
  p.adjust.method = "none",
  threshold = 0.05,
  direction = "taxa",
  pathway = "KO",
  confounders = NULL,
  reference = NULL,
  min_samples = 5,
  verbose = TRUE
)
}
\arguments{
\item{stratified_path}{\strong{character}. Path to PICRUSt2 stratified output
(tab-delimited) containing at least the columns:
\code{sample}, \code{taxon}, \code{function},
\code{norm_taxon_function_contrib}.}

\item{physeq}{\strong{phyloseq} object. Must contain both \code{tax_table}
(with an \code{ASV} rownames key) and \code{sample_data}.}

\item{taxon_level}{\strong{character}. Taxonomic rank to aggregate to when
\code{direction = "taxa"} (e.g., \code{"Genus"}, \code{"Family"}). Must be a
column in \code{phyloseq::tax_table(physeq)}.}

\item{group}{\strong{character}. Column name in \code{sample_data} indicating
the primary grouping variable for DAA (will be coerced to a factor).}

\item{daa_method}{\strong{character}. DAA backend name passed to
\code{pathway_daa()} (e.g., \code{"Maaslin2"}, \code{"edgeR"},
\code{"DESeq2"}, \code{"limma voom"}, \code{"metagenomeSeq"}, \code{"Lefser"}).}

\item{p.adjust.method}{\strong{character}. Multiple-testing correction method
forwarded to \code{pathway_daa()} (e.g., \code{"none"}, \code{"BH"}).}

\item{threshold}{\strong{numeric}. Significance cutoff used during annotation
(typically FDR/q-value threshold).}

\item{direction}{\strong{character}. One of \code{"taxa"} or \code{"function"}.
If \code{"taxa"}, the function aggregates ASV contributions to \code{taxon_level}
and analyzes per-taxon tables. If \code{"function"}, it groups by function
(KO/EC/MetaCyc) and analyzes per-function tables.}

\item{pathway}{\strong{character}. Functional namespace of the \code{function}
column: one of \code{"KO"}, \code{"EC"}, or \code{"MetaCyc"}. Controls
downstream annotation and (for KO) \code{ko_to_kegg} mapping.}

\item{confounders}{Optional covariate(s) to adjust for in DAA backends that
support them (e.g., edgeR/limma/Maaslin2). Either a vector (single covariate)
or a \code{data.frame}/tibble with one column per covariate. If a character
vector, the named columns are pulled from \code{sample_data(physeq)}. Must
align with samples in the abundance matrices. Characters are converted to
factors by the modeling backend.}

\item{reference}{\strong{character} or \code{NULL}. Optional reference level
for \code{group}; if supplied and present, \code{group} is releveled accordingly.}

\item{min_samples}{\strong{integer}. Require strictly more than this number of
samples in the per-table subset (after filtering to samples with non-missing
group) to run DAA. Default: \code{5}.}

\item{verbose}{\strong{logical}. If \code{TRUE}, print progress messages.}
}
\description{
Given a PICRUSt2 stratified output (e.g., \code{pred_metagenome_contrib.tsv})
and a \code{phyloseq} object, this function:
\enumerate{
  \item checks sample and taxa overlap,
  \item aggregates ASV-level contributions to a chosen taxonomy level
        (e.g., \code{"Genus"}) \emph{or} groups by function,
  \item constructs wide matrices (rows = KO/EC/MetaCyc IDs or taxa, cols = samples),
  \item filters tables with insufficient group representation,
  \item runs DAA via \code{pathway_daa()} (supports edgeR/DESeq2/limma-voom/Maaslin2/etc.),
  \item annotates significant results via \code{MicroFun::pathway_annotation()} or
        \code{result_annotation()}.
}
}
\details{
Build per-\code{taxon} or per-\code{function} abundance tables from a
stratified PICRUSt2 file and run differential abundance analysis (DAA)
at the pathway/function level, optionally adjusting for confounders.
}
\examples{
\dontrun{
# Example inputs (toy):
stratified_path <- "pred_metagenome_contrib.tsv"
group <- "Group"

# 1) Per-taxon KO analysis at Genus level using Maaslin2
res_taxa <- pathway_sdaa(
  stratified_path = stratified_path,
  physeq          = physeq_obj,
  taxon_level     = "Genus",
  group           = group,
  daa_method      = "Maaslin2",
  p.adjust.method = "BH",
  threshold       = 0.05,
  direction       = "taxa",
  pathway         = "KO",
  confounders     = c("age","sex"),
  reference       = "Control"
)

# 2) Per-function MetaCyc analysis without confounders
res_fun <- pathway_sdaa(
  stratified_path = stratified_path,
  physeq          = physeq_obj,
  taxon_level     = "Genus",
  group           = group,
  daa_method      = "edgeR",
  p.adjust.method = "BH",
  threshold       = 0.1,
  direction       = "function",
  pathway         = "MetaCyc"
)
}

}
